[build]
builder = "NIXPACKS"

[deploy]
healthcheckPath = "/health"
healthcheckTimeout = 100
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[[services]]
name = "backend"
source = "."
healthcheckPath = "/health"
healthcheckTimeout = 100
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[services.variables]
DATABASE_URL = "${{services.Postgres.DATABASE_URL}}"
JWT_SECRET = "${{secrets.JWT_SECRET}}"
LLM7_API_KEY = "${{secrets.LLM7_API_KEY}}"
PORT = "8000"

[[services]]
name = "postgres"
image = "postgres:15"

[services.variables]
POSTGRES_DB = "expenses_db"
POSTGRES_USER = "postgres"
POSTGRES_PASSWORD = "${{secrets.POSTGRES_PASSWORD}}"
